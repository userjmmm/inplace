<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/base :: common_header(~{::title}, ~{::link}, ~{::scripts})">
    <title>신고 관리</title>
    <link href="/css/report.css" rel="stylesheet">
    <th:block th:fragment="scripts">
        <script th:src="'https://code.jquery.com/jquery-3.6.0.min.js'" type="text/javascript"></script>
        <script src="/js/fragment/modal.js"></script>
        <script src="/js/report.js"></script>
    </th:block>
</head>

<body>


<header th:replace="fragment/header :: navigation_bar"></header>

<div class="tabs">
    <button onclick="showSection('posts')" id="tab-posts" class="active">신고된 게시글 리스트</button>
    <button onclick="showSection('comments')" id="tab-comments">신고된 댓글 리스트</button>
</div>

<div id="reported-posts">
    <table>
        <thead>
        <tr>
            <th>게시글 ID</th>
            <th>작성자 ID</th>
            <th>내용</th>
            <th>신고 여부</th>
            <th>삭제 상태</th>
            <th>관리</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="post : ${reportedPosts}">
            <td th:text="${post.id}"></td>
            <td th:text="${post.authorId}"></td>
            <td class="content-cell"
                th:text="${#strings.abbreviate(post.content, 50)}"
                th:attr="data-full-content=${post.content}"
                onclick="openContentModal(this)">
            </td>
            <td th:text="${post.isReported ? '신고됨' : '정상'}"></td>
            <td th:text="${post.deleteAt == null ? '삭제 안됨' : '삭제됨'}"></td>
            <td>
                <form th:action="@{/admin/post/delete/{postId}(postId=${post.id})}" method="post" style="display:inline;">
                    <button type="submit"
                            onclick="return confirm('정말 삭제하시겠습니까?');">
                        삭제
                    </button>
                </form>
                <form th:action="@{/admin/post/unreport/{postId}(postId=${post.id})}" method="post" style="display:inline;">
                    <button type="submit"
                            onclick="return confirm('이 게시글의 신고를 해제하고 유지하시겠습니까?');">
                        유지
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="reported-comments" style="display:none;">
    <table>
        <thead>
        <tr>
            <th>댓글 ID</th>
            <th>작성자 ID</th>
            <th>내용</th>
            <th>신고 여부</th>
            <th>삭제 상태</th>
            <th>관리</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="comment : ${reportedComments}">
            <td th:text="${comment.id}"></td>
            <td th:text="${comment.authorId}"></td>
            <td class="content-cell"
                th:text="${#strings.abbreviate(comment.content, 50)}"
                th:attr="data-full-content=${comment.content}"
                onclick="openContentModal(this)">
            </td>
            <td th:text="${comment.isReported ? '신고됨' : '정상'}"></td>
            <td th:text="${comment.deleteAt == null ? '삭제 안됨' : '삭제됨'}"></td>
            <td>
                <form th:action="@{/admin/comment/delete/{commentId}(commentId=${comment.id})}" method="post" style="display:inline;">
                    <button type="submit"
                            onclick="return confirm('정말 삭제하시겠습니까?');">
                        삭제
                    </button>
                </form>
                <form th:action="@{/admin/comment/unreport/{commentId}(commentId=${comment.id})}" method="post" style="display:inline;">
                    <button type="submit"
                            onclick="return confirm('이 댓글의 신고를 해제하고 유지하시겠습니까?');">
                        유지
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- 전체 내용용 모달 -->
<div th:replace="fragment/modal :: modal('contentModal', '전체 내용', ~{::contents})">
    <th:block th:fragment="contents">
        <div id="contentModalBody" style="white-space: pre-line;"></div>
    </th:block>
</div>
</body>
</html>

